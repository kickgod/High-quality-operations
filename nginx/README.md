### <a href="#top" id="top"> Nginx 中间件</a>
----
`Nginx(engine x)是一个高性能的HTTP和反向代理服务，也是一个IMAP/POP3/SMTP服务。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点
（俄文：Рамблер）开发的，第一个公开版本0.1.0发布于2004年10月4日。`

---
##### [`Nginx 特征`](#top)
* `IO多路复用,多线程,并且支持主动上报 多个描述符[文件描述符 windows 又叫文件句柄]的I/O操作都能在⼀个线程内并发交替地顺序完成，这就叫I/O多路复⽤，这⾥的 "复
⽤"指的是复⽤同⼀个线程。`
* `IO多路复⽤的实现⽅式有select、poll、Epool`
  * `select缺点`
    * `1.能够监视⽂件描述符的数量存在最⼤限制`
    * `2.线性遍历扫描效率低下`
  * `epool模型`
    * `1.每当FD就绪，采⽤系统的回调函数之间将fd放⼊,效率更⾼。`
    * `2.最⼤连接⽆限制`
* `将CPU核⼼和Nginx⼯作进程绑定⽅式，把每个worker进程固定在⼀个cpu上执⾏，减少切换cpu的 cache	miss ，获得更好的性能。`
##### [sendfile 零拷贝](#)
`传统⽂件传输, 在实现上其实是⽐较复杂的, 其具体流程细节如下：`
> * `1.调⽤read函数，⽂件数据被复制到内核缓冲`
> * `2.read函数返回，⽂件数据从内核缓冲区复制到⽤户缓冲区`
> * `3.write函数调⽤，将⽂件数据从⽤户缓冲区复制到内核与socket相关的缓冲区。`
> * `4.数据从socket缓冲区复制到相关协议引擎。`<br/>
> `传统⽂件传输数据实际上是经过了四次复制操作: 硬盘—>内核buf—>⽤户buf—>socket缓冲区(内核)—>协议引擎`
> `也就是说传统的⽂件传输需要经过多次上下⽂的切换才能完成拷⻉或读取, 效率不⾼。` <br/>

**`原理`**:`sendfile⽂件传输是在内核中操作完成的, 函数直接在两个⽂件描述符之间传递数据, 从⽽避免了内核缓冲区数据和⽤户缓冲区数据之间的拷⻉, 操作效率很⾼, 
被称之为零拷⻉。`
> * `1.系统调⽤sendfile函数通过 DMA 把硬盘数据拷⻉到 kernel buffer，`
> * `2.数据被 kernel 直接拷⻉到另外⼀个与 socket 相关的 kernel buffer。`
> * `3.DMA把数据从kernel buffer直接拷⻉给协议栈。`
> `这⾥没有⽤户空间和内核空间之间的切换，在内核中直接完成了从⼀个buffer到另⼀个buffer的拷⻉。`
